<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Í±¥Î¨º ÏúÑÌóò ÏßÑÎã®ÏÜå</title>

    <!-- Custom fonts for this template-->
    <link href="/static/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="/static/css/sb-admin-2.min.css" rel="stylesheet">

    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
            integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
    />
    <style>

      /* card ÏûêÏ≤¥Î•º flex column Ïª®ÌÖåÏù¥ÎÑàÎ°ú */
      .card.d-flex {
        display: flex;
        flex-direction: column;
      }

      /* Ïà®Í≤®Ï°åÎã§Í∞Ä ÌÅ¥Î¶≠ Ïãú Î≥¥Ïù¥ÎèÑÎ°ù Ìï† Í≥µÌÜµ ÌÅ¥ÎûòÏä§ */
      .info-card-body {
        display: none;        /* Í∏∞Î≥∏ Ïà®ÍπÄ */
        flex-grow: 1;         /* Ïπ¥Îìú ÎÜíÏù¥Ïóê ÎßûÏ∂∞ ÎäòÏñ¥ÎÇ® */
        overflow: auto;       /* ÎÇ¥Ïö©Ïù¥ ÎßéÏúºÎ©¥ Ïä§ÌÅ¨Î°§ */
      }
      .info-card-body.visible {
        display: flex;        /* Î≥¥Ïùº Îïê flex container */
        flex-direction: column;
      }
    #current-date {
      font-family: 'Nunito', sans-serif;
      color: #f8f9fa;
      font-size: 1.25rem;
      font-weight: 600;
    }
    #current-time {
      font-family: 'Nunito', sans-serif;
      color: #f8f9fa;
      font-size: 1.25rem;
      font-weight: 600;
    }
    #weather-temp {
      font-size: 2rem;
      color: #ffdd57;
      font-weight: bold;
    }
    #weather-desc {
      color: #ced4da;
      font-style: italic;
    }
    #weather-widget .small {
      color: #e9ecef;
      font-size: 0.85rem;
    }
    #weather-humidity, #weather-ws {
      color: #ffffff;
      font-weight: 500;
    }
    </style>
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a id="resetMap" class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-building"></i>
                </div>
                <div class="sidebar-brand-text mx-3">ÏúÑÌóò ÏßÑÎã®ÏÜå</div>
            </a>

              <li class="nav-item text-center pt-4">
                <span id="current-date" class="d-block small text-light mb-1"></span>
                <div class="d-flex justify-content-center align-items-center">
                  <i class="fas fa-clock fa-lg text-light mr-2"></i>
                  <span id="current-time" class="h5 text-light mb-0"></span>
                </div>
              </li>
              <hr class="sidebar-divider my-2">

              <!-- ÌòÑÏû¨ ÎÇ†Ïî® ÏúÑÏ†Ø -->
              <li class="nav-item text-center py-4">
                <div id="weather-widget">
                    <div id="weather-icon" class="mb-2" style="font-size:2.5rem;">
                        <!-- Ï¥àÍ∏∞ Î°úÎî© Ïä§ÌîºÎÑà -->
                        <i class="fas fa-spinner fa-pulse"></i>
                    </div>
                  <div id="weather-temp">--.-¬∞C</div>
                  <div id="weather-desc">Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
                  <div class="small mb-1">ÏäµÎèÑ: <strong id="weather-humidity"></strong>%</div>
                  <div class="small">ÌíçÏÜç: <strong id="weather-ws"></strong> m/s</div>
                </div>
              </li>
              <hr class="sidebar-divider d-none d-md-block">

        </ul>

        <script>
          // 1) Ïã§ÏãúÍ∞Ñ ÏãúÍ≥Ñ
          function updateClock(){
            const now = new Date();
            const yyyy = now.getFullYear();
            const mm   = String(now.getMonth()+1).padStart(2,'0');
            const dd   = String(now.getDate()).padStart(2,'0');
            document.getElementById('current-date').textContent = `${yyyy}-${mm}-${dd}`;

            // ÏãúÍ∞Ñ: HH:MM:SS
            const hh = String(now.getHours()).padStart(2,'0');
            const mi = String(now.getMinutes()).padStart(2,'0');
            const ss = String(now.getSeconds()).padStart(2,'0');
            document.getElementById('current-time').textContent = `${hh}:${mi}:${ss}`;
          }
          setInterval(updateClock, 1000);
          updateClock();

          // 2) ÎÇ†Ïî® Î∂àÎü¨Ïò§Í∏∞
          async function loadWeather(){
            try {
              const res = await fetch('/api/weather');
              if(!res.ok) throw new Error('ÎÇ†Ïî® Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§');
              const { temp, wf, sky_code , humidity, ws, prep} = await res.json();

                // 1) Í∏∞Î≥∏ ÏïÑÏù¥ÏΩò Í≤∞Ï†ï
                let iconClass;
                switch (sky_code) {
                  case 'DB01': iconClass = 'sun';       break;
                  case 'DB02': iconClass = 'cloud-sun'; break;
                  case 'DB03': iconClass = 'cloud';     break; // Ìù∞ Íµ¨Î¶Ñ
                  case 'DB04': iconClass = 'cloud';     break; // ÌöåÏÉâ Íµ¨Î¶Ñ
                  default:     iconClass = 'cloud';     break;
                }

                // 2) DB04 + prep > 0 Ïù¥Î©¥ Í∞ïÏàò ÏïÑÏù¥ÏΩòÏúºÎ°ú ÎçÆÏñ¥Ïì∞Í∏∞
                if (sky_code === 'DB04' && prep > 0) {
                  switch (prep) {
                    case 1: iconClass = 'cloud-rain';        break;
                    case 2: iconClass = 'cloud-rain-snow';   break;
                    case 3: iconClass = 'cloud-snow';        break;
                    case 4: iconClass = 'cloud-showers-heavy'; break;
                  }
                }
                // 3) ÏÉâÏÉÅ ÌÅ¥ÎûòÏä§ Í≤∞Ï†ï
                // DB03 ‚Üí Ìù∞ÏÉâ, DB04 ‚Üí ÌöåÏÉâ, ÎÇòÎ®∏ÏßÄ ‚Üí Í∏∞Î≥∏
                let colorClass = '';
                if (sky_code === 'DB03') colorClass = 'white';
                else if (sky_code === 'DB04' && prep === 0) colorClass = 'grey';

              document.getElementById('weather-icon').innerHTML    = `<i class="fas fa-${iconClass}"></i>`;
              document.getElementById('weather-temp').textContent  = `${temp.toFixed(1)}¬∞C`;
              document.getElementById('weather-desc').textContent  = wf;
              document.getElementById('weather-humidity').textContent = humidity;
              document.getElementById('weather-ws').textContent    = ws.toFixed(1);
            } catch(e){
              console.error(e);
            }
          }
          // ÌéòÏù¥ÏßÄ Î°úÎî© Ïãú, Í∑∏Î¶¨Í≥† Îß§ÏãúÍ∞Ñ Í∞±Ïã†
          document.addEventListener('DOMContentLoaded', ()=>{
            loadWeather();
            setInterval(loadWeather, 1000*60*60);
          });
        </script>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <!-- Topbar Search -->
                    <div
                        class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                        <div class="input-group">
                            <input type="text" class="form-control bg-light border-0 small" placeholder="Search for..."
                                aria-label="Search" aria-describedby="basic-addon2" id="search-input">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="button" id="search-button">
                                    <i class="fas fa-search fa-sm"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">

                        <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                        <li class="nav-item dropdown no-arrow d-sm-none">
                            <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-search fa-fw"></i>
                            </a>
                            <!-- Dropdown - Messages -->
                            <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                                aria-labelledby="searchDropdown">
                                <form class="form-inline mr-auto w-100 navbar-search">
                                    <div class="input-group">
                                        <input type="text" class="form-control bg-light border-0 small"
                                            placeholder="Search for..." aria-label="Search"
                                            aria-describedby="basic-addon2">
                                        <div class="input-group-append">
                                            <button class="btn btn-primary" type="button">
                                                <i class="fas fa-search fa-sm"></i>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </li>

                        <!-- Nav Item - Alerts -->
                        <li class="nav-item dropdown no-arrow mx-1">
                            <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-bell fa-fw"></i>
                                <!-- Counter - Alerts -->
                                <span class="badge badge-danger badge-counter">3+</span>
                            </a>
                            <!-- Dropdown - Alerts -->
                            <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="alertsDropdown">
                                <h6 class="dropdown-header">
                                    Alerts Center
                                </h6>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="mr-3">
                                        <div class="icon-circle bg-primary">
                                            <i class="fas fa-file-alt text-white"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="small text-gray-500">December 12, 2019</div>
                                        <span class="font-weight-bold">A new monthly report is ready to download!</span>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="mr-3">
                                        <div class="icon-circle bg-success">
                                            <i class="fas fa-donate text-white"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="small text-gray-500">December 7, 2019</div>
                                        $290.29 has been deposited into your account!
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="mr-3">
                                        <div class="icon-circle bg-warning">
                                            <i class="fas fa-exclamation-triangle text-white"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="small text-gray-500">December 2, 2019</div>
                                        Spending Alert: We've noticed unusually high spending for your account.
                                    </div>
                                </a>
                                <a class="dropdown-item text-center small text-gray-500" href="#">Show All Alerts</a>
                            </div>
                        </li>

                        <!-- Nav Item - Messages -->
                        <li class="nav-item dropdown no-arrow mx-1">
                            <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-envelope fa-fw"></i>
                                <!-- Counter - Messages -->
                                <span class="badge badge-danger badge-counter">7</span>
                            </a>
                            <!-- Dropdown - Messages -->
                            <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="messagesDropdown">
                                <h6 class="dropdown-header">
                                    Message Center
                                </h6>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3">
                                        <img class="rounded-circle" src="img/undraw_profile_1.svg"
                                            alt="...">
                                        <div class="status-indicator bg-success"></div>
                                    </div>
                                    <div class="font-weight-bold">
                                        <div class="text-truncate">Hi there! I am wondering if you can help me with a
                                            problem I've been having.</div>
                                        <div class="small text-gray-500">Emily Fowler ¬∑ 58m</div>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3">
                                        <img class="rounded-circle" src="img/undraw_profile_2.svg"
                                            alt="...">
                                        <div class="status-indicator"></div>
                                    </div>
                                    <div>
                                        <div class="text-truncate">I have the photos that you ordered last month, how
                                            would you like them sent to you?</div>
                                        <div class="small text-gray-500">Jae Chun ¬∑ 1d</div>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3">
                                        <img class="rounded-circle" src="img/undraw_profile_3.svg"
                                            alt="...">
                                        <div class="status-indicator bg-warning"></div>
                                    </div>
                                    <div>
                                        <div class="text-truncate">Last month's report looks great, I am very happy with
                                            the progress so far, keep up the good work!</div>
                                        <div class="small text-gray-500">Morgan Alvarez ¬∑ 2d</div>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3">
                                        <img class="rounded-circle" src="https://source.unsplash.com/Mv9hjnEUHR4/60x60"
                                            alt="...">
                                        <div class="status-indicator bg-success"></div>
                                    </div>
                                    <div>
                                        <div class="text-truncate">Am I a good boy? The reason I ask is because someone
                                            told me that people say this to all dogs, even if they aren't good...</div>
                                        <div class="small text-gray-500">Chicken the Dog ¬∑ 2w</div>
                                    </div>
                                </a>
                                <a class="dropdown-item text-center small text-gray-500" href="#">Read More Messages</a>
                            </div>
                        </li>

                        <div class="topbar-divider d-none d-sm-block"></div>

                        <!-- Nav Item - User Information -->
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small">Douglas McGee</span>
                                <img class="img-profile rounded-circle"
                                    src="img/undraw_profile.svg">
                            </a>
                            <!-- Dropdown - User Information -->
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="userDropdown">
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Profile
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Settings
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Activity Log
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Logout
                                </a>
                            </div>
                        </li>

                    </ul>

                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Ïû¨ÎÇúÎ≥Ñ ÏúÑÌóòÏÑ± ÌÜµÍ≥Ñ</h1>
                        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                                class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>
                    </div>

                    <!-- Content Row -->
                    <div class="row">

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                ÌÉúÌíç/Í∞ïÌíç
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                  <div id="tornado-score-text" class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                                                    0Ï†ê
                                                  </div>
                                                </div>
                                                <div class="col">
                                                  <div class="progress progress-sm mr-2">
                                                    <div
                                                      id="tornado-score-bar"
                                                      class="progress-bar bg-info"
                                                      role="progressbar"
                                                      style="width: 0%"
                                                      aria-valuenow="0"
                                                      aria-valuemin="0"
                                                      aria-valuemax="100"
                                                    ></div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                        <div class="col-auto">
                                        <span
                                          class="iconify"
                                          data-icon="mdi:weather-tornado"
                                          data-inline="true"
                                          style="font-size:2rem; color:#17a2b8;"
                                        ></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                ÌôçÏàò/Ïπ®Ïàò
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                  <div id="drown-score-text" class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                                                    0Ï†ê
                                                  </div>
                                                </div>
                                                <div class="col">
                                                  <div class="progress progress-sm mr-2">
                                                    <div
                                                      id="drown-score-bar"
                                                      class="progress-bar bg-primary"
                                                      role="progressbar"
                                                      style="width: 0%"
                                                      aria-valuenow="0"
                                                      aria-valuemin="0"
                                                      aria-valuemax="100"
                                                    ></div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                        <div class="col-auto">
                                            <i class="fas fa-cloud-showers-heavy fa-2x text-primary"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                ÏßÄÏßÑ/Î∂ïÍ¥¥
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                  <div id="earthquake-score-text" class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                                                    0Ï†ê
                                                  </div>
                                                </div>
                                                <div class="col">
                                                  <div class="progress progress-sm mr-2">
                                                    <div
                                                      id="earthquake-score-bar"
                                                      class="progress-bar bg-warning"
                                                      role="progressbar"
                                                      style="width: 0%"
                                                      aria-valuenow="0"
                                                      aria-valuemin="0"
                                                      aria-valuemax="100"
                                                    ></div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                        <div class="col-auto">
                                            <span
                                              class="iconify"
                                              data-icon="fa6-solid:house-crack"
                                              data-inline="true"
                                              style="font-size:2rem; color:#ffc107;"
                                            ></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pending Requests Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-danger shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                                ÏÇ∞Î∂à/ÌôîÏû¨
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                  <div id="fire-score-text" class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                                                    0Ï†ê
                                                  </div>
                                                </div>
                                                <div class="col">
                                                  <div class="progress progress-sm mr-2">
                                                    <div
                                                      id="fire-score-bar"
                                                      class="progress-bar bg-danger"
                                                      role="progressbar"
                                                      style="width: 0%"
                                                      aria-valuenow="0"
                                                      aria-valuemin="0"
                                                      aria-valuemax="100"
                                                    ></div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                        <div class="col-auto">
                                            <i class="fas fa-fire fa-2x text-danger"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Row -->

                    <div class="row">

                        <!-- Area Chart -->
                        <div class="col-xl-8 col-lg-7">
                            <div class="card shadow mb-4" style="min-height: 500px;">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Seoul Maps</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-area">
                                        <div id="map-container"  style="width: 100%; height: 400px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- risk Bar Chart -->
                        <div class="col-xl-4 col-lg-5">
                            <div class="card shadow mb-4" style="min-height: 500px;">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">ÏßÑÎã® Í∑ºÍ±∞</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-bar pt-4 pb-2 d-flex justify-content-center">
                                        <canvas id="riskBarChart" style="max-width: 300px; width: 100%"></canvas>
                                    </div>
                                    <div class="mt-4 text-center small">
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-info"></i> ÌÉúÌíç/Í∞ïÌíç
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-primary"></i> ÌôçÏàò/Ïπ®Ïàò
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-warning"></i> ÏßÄÏßÑ/Î∂ïÍ¥¥
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-danger"></i> ÏÇ∞Î∂à/ÌôîÏû¨
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Row -->
                    <div class="row">

                        <!-- Content Column -->
                        <div class="col-lg-6 mb-4">
                            <!-- Illustrations -->
                            <div class="card shadow mb-4 d-flex flex-column">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Í±¥Ï∂ïÎ¨º Ï†ïÎ≥¥</h6>
                                </div>
                                <div id="building-info-container" class="card-body info-card-body">
                                    <div id="building-info" class="text-center"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6 mb-4">
                            <!-- Approach -->
                            <div class="card shadow mb-4 d-flex flex-column">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">ÏÇ¨Í≥† Ïù¥Î†•</h6>
                                </div>
                                <div id="accident-history-container" class="card-body info-card-body">
                                    <div id="accident-history" class="text-center"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Your Website 2021</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">√ó</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="/static/vendor/jquery/jquery.min.js"></script>
    <script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="/static/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="/static/js/sb-admin-2.min.js"></script>

        <!-- MarkerClusterer Î°úÎìú (initMap Ìò∏Ï∂ú Ï†ÑÏóê) -->
    <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

    <script src="https://code.iconify.design/2/2.2.1/iconify.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // ‚ë† Chart.js ÌîåÎü¨Í∑∏Ïù∏ Îì±Î°ù
        Chart.register(ChartDataLabels);

       // Bar Ï∞®Ìä∏ ÏÉùÏÑ±
       const ctx = document.getElementById('riskBarChart').getContext('2d');
       window.riskBarChart = new Chart(ctx, {
         type: 'bar',
         data: {
           labels: ['ÌÉúÌíç/Í∞ïÌíç','ÌôçÏàò/Ïπ®Ïàò','ÏßÄÏßÑ/Î∂ïÍ¥¥','ÏÇ∞Î∂à/ÌôîÏû¨'],
           datasets: [{
             label: 'ÏúÑÌóò Ï†êÏàò',
             data: [0, 0, 0, 0],
             // backgroundColorÏôÄ borderColorÎäî CSSÎ°ú Ï°∞Ï†ïÌïòÍ±∞ÎÇò Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©
             borderWidth: 1
           }]
         },
         options: {
           responsive: true,
           maintainAspectRatio: false,
           scales: {
             y: {
               beginAtZero: true,
               max: 100
             }
           },
           plugins: {
             datalabels: {
               anchor: 'end',
               align: 'end',
               formatter: (value) => value.toFixed(2) + 'Ï†ê',
               font: { weight: 'bold', size: 12 }
             },
             legend: { display: false }
           }
         }
       });
        });
    </script>
    <script>
    function initMap() {
        initialCenter = { lat: 37.4968, lng:  127.0628 };
        initialZoom   = 12
        const markerZoom = 15;

        const map = new google.maps.Map(document.getElementById("map-container"), {
            zoom: initialZoom,
            center: initialCenter,
        });

        let buildings_data = [];
        const markers = [];  // ÎßàÏª§Î•º Îã¥ÏùÑ Î∞∞Ïó¥

        // Ï†ÑÏó≠ÏóêÏÑú ÏÑ†ÌÉùÎêú ÎßàÏª§Î•º Í∏∞Ïñµ
        let selectedMarker = null;
        // Í∞ïÏ°∞Ïö© ÏïÑÏù¥ÏΩò (ÎÖπÏÉâ)
        const highlightIcon = {
        url: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
        };
        const buildingBody   = document.getElementById('building-info-container');
        const accidentBody   = document.getElementById('accident-history-container');

        fetch('/api/buildings')
            .then(response => response.json())
            .then(buildings => {
                buildings_data = buildings;
                buildings.forEach((building, index) => {

                    const marker = new google.maps.Marker({
                        position: { lat: building.lat, lng: building.lng },
                        map: map,
                        title: building.address
                    });

                    marker.defaultIcon = marker.getIcon();

                    marker.addListener('click', () => {
                      // Ïù¥Ï†ÑÏóê Ïà®Í≤®Ï°åÎçò Ïπ¥Îìú-body Îëê Í∞úÎ•º Î≥¥Ïù¥ÎèÑÎ°ù
                      buildingBody.classList.add('visible');
                      accidentBody.classList.add('visible');

                      // 2) Ïù¥Ï†Ñ ÏÑ†ÌÉù Ìï¥Ï†ú
                      if (selectedMarker) {
                        selectedMarker.setIcon(selectedMarker.defaultIcon);
                      }

                      // 3) ÌòÑÏû¨ ÌÅ¥Î¶≠Îêú ÎßàÏª§ Í∞ïÏ°∞
                      marker.setIcon(highlightIcon);
                      selectedMarker = marker;

                      const infoDiv = document.getElementById('building-info');
                      const { address, lat, lng } = building;  // /api/buildingsÏóêÏÑú ÎÑòÏñ¥Ïò® Í∞ùÏ≤¥
                      const streetViewUrl = `https://maps.googleapis.com/maps/api/streetview?size=600x200&location=${lat},${lng}&fov=90&heading=235&pitch=10&key=AIzaSyCQWM6dFymuis1oh9DelTIPFO1igh1nVuo`;

                      // 1) API Ìò∏Ï∂ú Ï†ÑÏóê, ÏùºÎã® Ï£ºÏÜå¬∑Ï¢åÌëú Î®ºÏ†Ä Î≥¥Ïó¨Ï£ºÍ∏∞
                      infoDiv.innerHTML = `
                        <p><strong>Ï£ºÏÜå:</strong> ${address}</p>
                        <p><strong>ÏúÑÎèÑ:</strong> ${lat.toFixed(6)}, <strong>Í≤ΩÎèÑ:</strong> ${lng.toFixed(6)}</p>
                        <div class="img-container flex-grow-1 d-flex justify-content-center align-items-center"
                             style="width:100%; height:500px;overflow:hidden; border:1px solid #ddd; margin-top:8px;">
                          <img
                            src="${streetViewUrl}"
                            style="width:100%;height:100%;object-fit:cover;"
                            alt="Street View"/>
                        </div>
                      `;


                      // ÏòàÏ∏° Ï†êÏàò Î°úÎî© Ïä§ÌîºÎÑà ÌëúÏãú
                      const scoreFireEl = document.getElementById('fire-score-text');
                      scoreFireEl.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"></div>';

                      const scoreDrownEl = document.getElementById('drown-score-text');
                      scoreDrownEl.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"></div>';

                      const scoreTornadoEl = document.getElementById('tornado-score-text');
                      scoreTornadoEl.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"></div>';

                      const scoreEarthquakeEl = document.getElementById('earthquake-score-text');
                      scoreEarthquakeEl.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"></div>';

                      // ÏòàÏ∏° ÏöîÏ≤≠

                      fetch('/api/predict', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({ index: index })
                      })
                      .then(response => response.json())
                      .then(data => {
                          if (data.error) {
                              alert(`Ïò§Î•ò: ${data.error}`);
                        } else {
                              const r = data.raw;      // { tornado, drown, earthquake, fire }
                              const t = data.total;   // { tornado, drown, earthquake, fire }

                              ['tornado','drown','earthquake','fire'].forEach(key => {
                                const rawVal = Number(r[key]) || 0;
                                const textEl = document.getElementById(`${key}-score-text`);
                                const barEl  = document.getElementById(`${key}-score-bar`);

                                textEl.textContent = `${rawVal.toFixed(2)}Ï†ê`;
                                barEl.style.width = `${rawVal.toFixed(2)}%`;
                                barEl.setAttribute('aria-valuenow', rawVal.toFixed(2));
                              });


                              // 3) total Ï†êÏàò ‚Üí bar Ï∞®Ìä∏Ïóê Î∞òÏòÅ
                              const barData = [
                                Number(r.tornado)    || 0,
                                Number(r.drown)      || 0,
                                Number(r.earthquake) || 0,
                                Number(r.fire)       || 0
                              ];
                              window.riskBarChart.data.datasets[0].data = barData;
                              window.riskBarChart.update();
                          }
                        })
                        .catch(error => {
                            alert('ÏòàÏ∏° ÏöîÏ≤≠ Ïã§Ìå®');
                        });
                      map.panTo(marker.getPosition());
                      if (map.getZoom() < markerZoom) {
                        map.setZoom(markerZoom);
                      }
                    });
                    markers.push(marker);
                });
                new markerClusterer.MarkerClusterer({ map, markers });
            })
            .catch(error => {
                console.error('Error fetching buildings:', error);
            });
            document.addEventListener('DOMContentLoaded', () => {
                const input = document.getElementById('search-input');
                const btn = document.getElementById('search-button');

                input.addEventListener('keyup', e => {
                    if (e.key === 'Enter') {
                        btn.click();
                    }
                });
                btn.addEventListener('click', () => {
                    const query = input.value.trim();

                    console.log("üîç Í≤ÄÏÉâÏñ¥:", query);
                    const idx = buildings_data.findIndex(b => b.address.includes(query));
                    console.log("üëâ findIndex Í≤∞Í≥º:", idx);

                    if (idx === -1) {
                        alert('Ìï¥Îãπ Ï£ºÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    } else {
                        const m = markers[idx];
                        map.panTo(m.getPosition());
                        map.setZoom(18);
                        google.maps.event.trigger(m, 'click');
                    }
                });
                document.getElementById('resetMap')
                    .addEventListener('click', (e) => {
                        e.preventDefault();               // href="#" Í∏∞Î≥∏ ÎèôÏûë ÎßâÍ∏∞
                        map.setCenter(initialCenter);
                        map.setZoom(initialZoom);

                        // 2) ÏÑ†ÌÉùÎêú ÎßàÏª§Í∞Ä ÏûàÏúºÎ©¥ ÏïÑÏù¥ÏΩò ÏõêÎ≥µ
                        if (selectedMarker) {
                            selectedMarker.setIcon(selectedMarker.defaultIcon);
                            selectedMarker = null;
                        }
                        // 3) Ï†ïÎ≥¥ Ìå®ÎÑêÍ≥º Ï†êÏàò Ï¥àÍ∏∞Ìôî
                        document.getElementById('building-info').innerHTML = '';
                        document.getElementById('accident-history').innerHTML = '';

                        ['tornado','drown','earthquake','fire'].forEach(key => {
                            const textEl = document.getElementById(`${key}-score-text`);
                            const barEl  = document.getElementById(`${key}-score-bar`);

                            textEl.textContent = '';
                            barEl.style.width = '0%';
                            barEl.setAttribute('aria-valuenow', 0);
                        });

                        // 5) ‚òÖ Ï∂îÍ∞ÄÎêú Î∂ÄÎ∂Ñ: search-input ÎÇ¥Î∂Ä ÎÇ¥Ïö©ÎèÑ ÎπÑÏö∞Í∏∞
                        const searchInput = document.getElementById('search-input');
                        if (searchInput) {
                          searchInput.value = '';  // Í≤ÄÏÉâ Í≤∞Í≥ºÎÇò ÏïàÎÇ¥ ÌÖçÏä§Ìä∏ Î™®Îëê Ï†úÍ±∞
                        }
                        // 6) bar Ï∞®Ìä∏ÎèÑ 0ÏúºÎ°ú Ï¥àÍ∏∞Ìôî
                        window.riskBarChart.data.datasets[0].data = [0, 0, 0, 0];
                        window.riskBarChart.update();
                    });
            });
    }
    </script>

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCQWM6dFymuis1oh9DelTIPFO1igh1nVuo&callback=initMap">
    </script>
</body>

</html>