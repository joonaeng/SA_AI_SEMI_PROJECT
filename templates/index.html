<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>건물 위험 진단소</title>

    <!-- Custom fonts for this template-->
    <link href="/static/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="/static/css/sb-admin-2.min.css" rel="stylesheet">

    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
            integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
    />
    <style>

      /* card 자체를 flex column 컨테이너로 */
      .card.d-flex {
        display: flex;
        flex-direction: column;
      }

      /* 숨겨졌다가 클릭 시 보이도록 할 공통 클래스 */
      .info-card-body {
        display: none;        /* 기본 숨김 */
        flex-grow: 1;         /* 카드 높이에 맞춰 늘어남 */
        overflow: auto;       /* 내용이 많으면 스크롤 */
      }
      .info-card-body.visible {
        display: flex;        /* 보일 땐 flex container */
        flex-direction: column;
      }
    #current-date {
      font-family: 'Nunito', sans-serif;
      color: #f8f9fa;
      font-size: 1.25rem;
      font-weight: 600;
    }
    #current-time {
      font-family: 'Nunito', sans-serif;
      color: #f8f9fa;
      font-size: 1.25rem;
      font-weight: 600;
    }
    #weather-temp {
      font-size: 2rem;
      color: #ffdd57;
      font-weight: bold;
    }
    #weather-desc {
      color: #ced4da;
      font-style: italic;
    }
    #weather-widget .small {
      color: #e9ecef;
      font-size: 0.85rem;
    }
    #weather-humidity, #weather-ws {
      color: #ffffff;
      font-weight: 500;
    }
      #drown-score-text {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 2rem;        /* 필요에 따라 조정 */
      font-size: 2rem;   /* 원하시는 크기로 변경 */
      font-weight: bold;
    }
    </style>
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a id="resetMap" class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-building"></i>
                </div>
                <div class="sidebar-brand-text mx-3">위험 진단소</div>
            </a>

              <li class="nav-item text-center pt-4">
                <span id="current-date" class="d-block small text-light mb-1"></span>
                <div class="d-flex justify-content-center align-items-center">
                  <i class="fas fa-clock fa-lg text-light mr-2"></i>
                  <span id="current-time" class="h5 text-light mb-0"></span>
                </div>
              </li>
              <hr class="sidebar-divider my-2">

              <!-- 현재 날씨 위젯 -->
              <li class="nav-item text-center py-4">
                <div id="weather-widget">
                    <div id="weather-icon" class="mb-2" style="font-size:2.5rem;">
                        <!-- 초기 로딩 스피너 -->
                        <i class="fas fa-spinner fa-pulse"></i>
                    </div>
                  <div id="weather-temp">--.-°C</div>
                  <div id="weather-desc">불러오는 중...</div>
                  <div class="small mb-1">습도: <strong id="weather-humidity"></strong>%</div>
                  <div class="small">풍속: <strong id="weather-ws"></strong> m/s</div>
                </div>
              </li>
              <hr class="sidebar-divider d-none d-md-block">

        </ul>

        <script>
          // 1) 실시간 시계
          function updateClock(){
            const now = new Date();
            const yyyy = now.getFullYear();
            const mm   = String(now.getMonth()+1).padStart(2,'0');
            const dd   = String(now.getDate()).padStart(2,'0');
            document.getElementById('current-date').textContent = `${yyyy}-${mm}-${dd}`;

            // 시간: HH:MM:SS
            const hh = String(now.getHours()).padStart(2,'0');
            const mi = String(now.getMinutes()).padStart(2,'0');
            const ss = String(now.getSeconds()).padStart(2,'0');
            document.getElementById('current-time').textContent = `${hh}:${mi}:${ss}`;
          }
          setInterval(updateClock, 1000);
          updateClock();

          // 2) 날씨 불러오기
          async function loadWeather(){

              const iconEl     = document.getElementById('weather-icon');
              const tempEl     = document.getElementById('weather-temp');
              const descEl     = document.getElementById('weather-desc');
              const humiEl     = document.getElementById('weather-humidity');
              const wsEl       = document.getElementById('weather-ws');

              iconEl.innerHTML = `<i class="fas fa-spinner fa-pulse"></i>`;
              descEl.textContent = '불러오는 중...';
            try {
              const res = await fetch('/api/weather');
              if(!res.ok) throw new Error('날씨 정보를 가져올 수 없습니다');
              const { temp, wf, sky_code , humidity, ws, prep} = await res.json();

                // 1) 기본 아이콘 결정
                let iconClass;
                switch (sky_code) {
                  case 'DB01': iconClass = 'sun';       break;
                  case 'DB02': iconClass = 'cloud-sun'; break;
                  case 'DB03': iconClass = 'cloud';     break; // 흰 구름
                  case 'DB04': iconClass = 'cloud';     break; // 회색 구름
                  default:     iconClass = 'cloud';     break;
                }

                // 2) DB04 + prep > 0 이면 강수 아이콘으로 덮어쓰기
                if (sky_code === 'DB04' && prep > 0) {
                  switch (prep) {
                    case 1: iconClass = 'cloud-rain';        break;
                    case 2: iconClass = 'cloud-rain-snow';   break;
                    case 3: iconClass = 'cloud-snow';        break;
                    case 4: iconClass = 'cloud-showers-heavy'; break;
                  }
                }
                // 3) 색상 클래스 결정
                // DB03 → 흰색, DB04 → 회색, 나머지 → 기본
                let colorClass = '';
                if (sky_code === 'DB03') colorClass = 'white';
                else if (sky_code === 'DB04') colorClass = 'grey';

                iconEl.innerHTML = `<i class="fas fa-${iconClass} fa-2x ${colorClass}"></i>`;
                tempEl.textContent = `${temp.toFixed(1)}°C`;
                descEl.textContent = wf;
                humiEl.textContent = humidity;
                wsEl.textContent   = ws.toFixed(1);
            } catch(e){
              console.error(e);
            }
          }
          // 페이지 로딩 시, 그리고 매시간 갱신
          document.addEventListener('DOMContentLoaded', ()=>{
            loadWeather();
            setInterval(loadWeather, 1000*60*60);
          });
        </script>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <!-- Topbar Search -->
                    <div
                        class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                        <div class="input-group">
                            <input type="text" class="form-control bg-light border-0 small" placeholder="Search for..."
                                aria-label="Search" aria-describedby="basic-addon2" id="search-input">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="button" id="search-button">
                                    <i class="fas fa-search fa-sm"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">

                        <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                        <li class="nav-item dropdown no-arrow d-sm-none">
                            <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-search fa-fw"></i>
                            </a>
                            <!-- Dropdown - Messages -->
                            <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                                aria-labelledby="searchDropdown">
                                <form class="form-inline mr-auto w-100 navbar-search">
                                    <div class="input-group">
                                        <input type="text" class="form-control bg-light border-0 small"
                                            placeholder="Search for..." aria-label="Search"
                                            aria-describedby="basic-addon2">
                                        <div class="input-group-append">
                                            <button class="btn btn-primary" type="button">
                                                <i class="fas fa-search fa-sm"></i>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </li>

                        <!-- Nav Item - Alerts -->
                        <li class="nav-item dropdown no-arrow mx-1">
                            <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-bell fa-fw"></i>
                                <!-- Counter - Alerts -->
                                <span class="badge badge-danger badge-counter">3+</span>
                            </a>
                            <!-- Dropdown - Alerts -->
                            <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="alertsDropdown">
                                <h6 class="dropdown-header">
                                    Alerts Center
                                </h6>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="mr-3">
                                        <div class="icon-circle bg-primary">
                                            <i class="fas fa-file-alt text-white"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="small text-gray-500">December 12, 2019</div>
                                        <span class="font-weight-bold">A new monthly report is ready to download!</span>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="mr-3">
                                        <div class="icon-circle bg-success">
                                            <i class="fas fa-donate text-white"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="small text-gray-500">December 7, 2019</div>
                                        $290.29 has been deposited into your account!
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="mr-3">
                                        <div class="icon-circle bg-warning">
                                            <i class="fas fa-exclamation-triangle text-white"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="small text-gray-500">December 2, 2019</div>
                                        Spending Alert: We've noticed unusually high spending for your account.
                                    </div>
                                </a>
                                <a class="dropdown-item text-center small text-gray-500" href="#">Show All Alerts</a>
                            </div>
                        </li>

                        <!-- Nav Item - Messages -->
                        <li class="nav-item dropdown no-arrow mx-1">
                            <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-envelope fa-fw"></i>
                                <!-- Counter - Messages -->
                                <span class="badge badge-danger badge-counter">7</span>
                            </a>
                            <!-- Dropdown - Messages -->
                            <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="messagesDropdown">
                                <h6 class="dropdown-header">
                                    Message Center
                                </h6>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3">
                                        <img class="rounded-circle" src="img/undraw_profile_1.svg"
                                            alt="...">
                                        <div class="status-indicator bg-success"></div>
                                    </div>
                                    <div class="font-weight-bold">
                                        <div class="text-truncate">Hi there! I am wondering if you can help me with a
                                            problem I've been having.</div>
                                        <div class="small text-gray-500">Emily Fowler · 58m</div>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3">
                                        <img class="rounded-circle" src="img/undraw_profile_2.svg"
                                            alt="...">
                                        <div class="status-indicator"></div>
                                    </div>
                                    <div>
                                        <div class="text-truncate">I have the photos that you ordered last month, how
                                            would you like them sent to you?</div>
                                        <div class="small text-gray-500">Jae Chun · 1d</div>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3">
                                        <img class="rounded-circle" src="img/undraw_profile_3.svg"
                                            alt="...">
                                        <div class="status-indicator bg-warning"></div>
                                    </div>
                                    <div>
                                        <div class="text-truncate">Last month's report looks great, I am very happy with
                                            the progress so far, keep up the good work!</div>
                                        <div class="small text-gray-500">Morgan Alvarez · 2d</div>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3">
                                        <img class="rounded-circle" src="https://source.unsplash.com/Mv9hjnEUHR4/60x60"
                                            alt="...">
                                        <div class="status-indicator bg-success"></div>
                                    </div>
                                    <div>
                                        <div class="text-truncate">Am I a good boy? The reason I ask is because someone
                                            told me that people say this to all dogs, even if they aren't good...</div>
                                        <div class="small text-gray-500">Chicken the Dog · 2w</div>
                                    </div>
                                </a>
                                <a class="dropdown-item text-center small text-gray-500" href="#">Read More Messages</a>
                            </div>
                        </li>

                        <div class="topbar-divider d-none d-sm-block"></div>

                        <!-- Nav Item - User Information -->
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small">Douglas McGee</span>
                                <img class="img-profile rounded-circle"
                                    src="img/undraw_profile.svg">
                            </a>
                            <!-- Dropdown - User Information -->
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="userDropdown">
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Profile
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Settings
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Activity Log
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Logout
                                </a>
                            </div>
                        </li>

                    </ul>

                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">재난별 위험성 통계</h1>
                        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                                class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>
                    </div>

                    <!-- Content Row -->
                    <div class="row">

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                태풍/강풍
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                  <div id="tornado-score-text" class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                                                    0점
                                                  </div>
                                                </div>
                                                <div class="col">
                                                  <div class="progress progress-sm mr-2">
                                                    <div
                                                      id="tornado-score-bar"
                                                      class="progress-bar bg-info"
                                                      role="progressbar"
                                                      style="width: 0%"
                                                      aria-valuenow="0"
                                                      aria-valuemin="0"
                                                      aria-valuemax="100"
                                                    ></div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                        <div class="col-auto">
                                        <span
                                          class="iconify"
                                          data-icon="mdi:weather-tornado"
                                          data-inline="true"
                                          style="font-size:2rem; color:#17a2b8;"
                                        ></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                홍수/침수
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                  <div id="drown-rate-text" class="h5 mb-0 font-weight-bold text-gray-800">
                                                    평가 등급 :
                                                  </div>
                                                </div>
                                                <div class="col text-center">
                                                    <div id="drown-score-text"
                                                         class="h5 mb-0 font-weight-bold">
                                                        --
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                        <div class="col-auto">
                                            <i class="fas fa-cloud-showers-heavy fa-2x text-primary"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                지진/붕괴
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                  <div id="earthquake-score-text" class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                                                    0점
                                                  </div>
                                                </div>
                                                <div class="col">
                                                  <div class="progress progress-sm mr-2">
                                                    <div
                                                      id="earthquake-score-bar"
                                                      class="progress-bar bg-warning"
                                                      role="progressbar"
                                                      style="width: 0%"
                                                      aria-valuenow="0"
                                                      aria-valuemin="0"
                                                      aria-valuemax="100"
                                                    ></div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                        <div class="col-auto">
                                            <span
                                              class="iconify"
                                              data-icon="fa6-solid:house-crack"
                                              data-inline="true"
                                              style="font-size:2rem; color:#ffc107;"
                                            ></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pending Requests Card Example -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-danger shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                                산불/화재
                                            </div>
                                            <div class="row no-gutters align-items-center">
                                                <div class="col-auto">
                                                  <div id="fire-score-text" class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                                                    0점
                                                  </div>
                                                </div>
                                                <div class="col">
                                                  <div class="progress progress-sm mr-2">
                                                    <div
                                                      id="fire-score-bar"
                                                      class="progress-bar bg-danger"
                                                      role="progressbar"
                                                      style="width: 0%"
                                                      aria-valuenow="0"
                                                      aria-valuemin="0"
                                                      aria-valuemax="100"
                                                    ></div>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                        <div class="col-auto">
                                            <i class="fas fa-fire fa-2x text-danger"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Row -->

                    <div class="row">

                        <!-- Area Chart -->
                        <div class="col-xl-8 col-lg-7">
                            <div class="card shadow mb-4" style="min-height: 500px;">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Seoul Maps</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-area">
                                        <div id="map-container"  style="width: 100%; height: 400px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- risk Bar Chart -->
                        <div class="col-xl-4 col-lg-5">
                            <div class="card shadow mb-4" style="min-height: 500px;">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">진단 근거</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Dropdown Header:</div>
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-bar pt-4 pb-2 d-flex justify-content-center">
                                        <canvas id="riskBarChart" style="max-width: 300px; width: 100%"></canvas>
                                    </div>
                                    <div class="mt-4 text-center small">
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-info"></i> 태풍/강풍
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-primary"></i> 홍수/침수
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-warning"></i> 지진/붕괴
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-danger"></i> 산불/화재
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Row -->
                    <div class="row">

                        <!-- Content Column -->
                        <div class="col-lg-6 mb-4">
                            <!-- Illustrations -->
                            <div class="card shadow mb-4 d-flex flex-column">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">건축물 정보</h6>
                                </div>
                                <div id="building-info-container" class="card-body info-card-body">
                                    <div id="building-info" class="text-center"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6 mb-4">
                            <!-- Approach -->
                            <div class="card shadow mb-4 d-flex flex-column">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">사고 이력</h6>
                                </div>
                                <div id="accident-history-container" class="card-body info-card-body">
                                    <div id="accident-history" class="text-center"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Your Website 2021</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="/static/vendor/jquery/jquery.min.js"></script>
    <script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="/static/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="/static/js/sb-admin-2.min.js"></script>

        <!-- MarkerClusterer 로드 (initMap 호출 전에) -->
    <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

    <script src="https://code.iconify.design/2/2.2.1/iconify.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <script>
      // 점수(0,1,2)를 “안전/경고/위험” 등급과 색상으로 변환
      function getDrownStatus(score) {
        switch (Number(score)) {
          case 0: return { text: '안전', className: 'text-success'  };
          case 1: return { text: '경고', className: 'text-warning' };
          case 2: return { text: '위험', className: 'text-danger'    };
          default: return { text: '--',   className: 'text-secondary'   };
        }
      }
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // ① Chart.js 플러그인 등록
        Chart.register(ChartDataLabels);

       // Bar 차트 생성
       const ctx = document.getElementById('riskBarChart').getContext('2d');
       window.riskBarChart = new Chart(ctx, {
         type: 'bar',
         data: {
           labels: ['태풍/강풍','홍수/침수','지진/붕괴','산불/화재'],
           datasets: [{
             label: '위험 점수',
             data: [0, 0, 0, 0],
             // backgroundColor와 borderColor는 CSS로 조정하거나 기본값 사용
             borderWidth: 1
           }]
         },
         options: {
           responsive: true,
           maintainAspectRatio: false,
           scales: {
             y: {
               beginAtZero: true,
               max: 100
             }
           },
           plugins: {
             datalabels: {
               anchor: 'end',
               align: 'end',
               formatter: (value) => value.toFixed(2) + '점',
               font: { weight: 'bold', size: 12 }
             },
             legend: { display: false }
           }
         }
       });
        });
    </script>
    <script>
    function initMap() {
        initialCenter = { lat: 37.4968, lng:  127.0628 };
        initialZoom   = 12
        const markerZoom = 15;

        const map = new google.maps.Map(document.getElementById("map-container"), {
            zoom: initialZoom,
            center: initialCenter,
        });

        let buildings_data = [];
        const markers = [];  // 마커를 담을 배열

        // 전역에서 선택된 마커를 기억
        let selectedMarker = null;
        // 강조용 아이콘 (녹색)
        const highlightIcon = {
        url: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
        };
        const buildingBody   = document.getElementById('building-info-container');
        const accidentBody   = document.getElementById('accident-history-container');

        fetch('/api/buildings')
            .then(response => response.json())
            .then(buildings => {
                buildings_data = buildings;
                buildings.forEach((building, index) => {

                    const marker = new google.maps.Marker({
                        position: { lat: building.lat, lng: building.lng },
                        map: map,
                        title: building.address
                    });

                    marker.defaultIcon = marker.getIcon();

                    marker.addListener('click', () => {
                      // 이전에 숨겨졌던 카드-body 두 개를 보이도록
                      buildingBody.classList.add('visible');
                      accidentBody.classList.add('visible');

                      // 2) 이전 선택 해제
                      if (selectedMarker) {
                        selectedMarker.setIcon(selectedMarker.defaultIcon);
                      }

                      // 3) 현재 클릭된 마커 강조
                      marker.setIcon(highlightIcon);
                      selectedMarker = marker;

                      const infoDiv = document.getElementById('building-info');
                      const { address, lat, lng } = building;  // /api/buildings에서 넘어온 객체
                      const streetViewUrl = `https://maps.googleapis.com/maps/api/streetview?size=600x200&location=${lat},${lng}&fov=90&heading=235&pitch=10&key=AIzaSyCQWM6dFymuis1oh9DelTIPFO1igh1nVuo`;

                      // 1) API 호출 전에, 일단 주소·좌표 먼저 보여주기
                      infoDiv.innerHTML = `
                        <p><strong>주소:</strong> ${address}</p>
                        <p><strong>위도:</strong> ${lat.toFixed(6)}, <strong>경도:</strong> ${lng.toFixed(6)}</p>
                        <div class="img-container flex-grow-1 d-flex justify-content-center align-items-center"
                             style="width:100%; height:500px;overflow:hidden; border:1px solid #ddd; margin-top:8px;">
                          <img
                            src="${streetViewUrl}"
                            style="width:100%;height:100%;object-fit:cover;"
                            alt="Street View"/>
                        </div>
                      `;


                      // 예측 점수 로딩 스피너 표시
                      const scoreFireEl = document.getElementById('fire-score-text');
                      scoreFireEl.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"></div>';

                      const scoreDrownEl = document.getElementById('drown-score-text');
                      scoreDrownEl.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"></div>';
                      scoreDrownEl.style.color = '';

                      const scoreTornadoEl = document.getElementById('tornado-score-text');
                      scoreTornadoEl.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"></div>';

                      const scoreEarthquakeEl = document.getElementById('earthquake-score-text');
                      scoreEarthquakeEl.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"></div>';

                      // 예측 요청

                      fetch('/api/predict', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({ index: index })
                      })
                      .then(response => response.json())
                      .then(data => {
                          if (data.error) {
                              alert(`오류: ${data.error}`);
                        } else {
                              const r = data.raw;      // { tornado, drown, earthquake, fire }
                              const t = data.total;   // { tornado, drown, earthquake, fire }

                              ['tornado','earthquake','fire'].forEach(key => {
                                const rawVal = Number(r[key]) || 0;
                                const textEl = document.getElementById(`${key}-score-text`);
                                const barEl  = document.getElementById(`${key}-score-bar`);

                                textEl.textContent = `${rawVal.toFixed(2)}점`;
                                barEl.style.width = `${rawVal.toFixed(2)}%`;
                                barEl.setAttribute('aria-valuenow', rawVal.toFixed(2));
                              });
                              // 2) 'drown'만 평가 등급 텍스트 처리
                              const drownVal = Number(r.drown) || 0;
                              const status   = getDrownStatus(drownVal);
                              const drownE   = document.getElementById('drown-score-text');
                              // 1) 이전에 붙은 색 관련 클래스 제거
                              drownE.classList.remove('text-success','text-warning','text-danger','text-secondary');
                              // 2) 새로운 클래스 추가
                              drownE.classList.add(status.className);
                              // 3) 텍스트 갱신
                              drownE.textContent = status.text;

                              // 3) total 점수 → bar 차트에 반영
                              const barData = [
                                Number(r.tornado)    || 0,
                                Number(r.earthquake) || 0,
                                Number(r.fire)       || 0
                              ];
                              window.riskBarChart.data.datasets[0].data = barData;
                              window.riskBarChart.update();
                          }
                        })
                        .catch(error => {
                            alert('예측 요청 실패');
                        });
                      map.panTo(marker.getPosition());
                      if (map.getZoom() < markerZoom) {
                        map.setZoom(markerZoom);
                      }
                    });
                    markers.push(marker);
                });
                new markerClusterer.MarkerClusterer({ map, markers });
            })
            .catch(error => {
                console.error('Error fetching buildings:', error);
            });
            document.addEventListener('DOMContentLoaded', () => {
                const input = document.getElementById('search-input');
                const btn = document.getElementById('search-button');

                input.addEventListener('keyup', e => {
                    if (e.key === 'Enter') {
                        btn.click();
                    }
                });
                btn.addEventListener('click', () => {
                    const query = input.value.trim();

                    console.log("🔍 검색어:", query);
                    const idx = buildings_data.findIndex(b => b.address.includes(query));
                    console.log("👉 findIndex 결과:", idx);

                    if (idx === -1) {
                        alert('해당 주소를 찾을 수 없습니다.');
                    } else {
                        const m = markers[idx];
                        map.panTo(m.getPosition());
                        map.setZoom(18);
                        google.maps.event.trigger(m, 'click');
                    }
                });
                document.getElementById('resetMap')
                    .addEventListener('click', (e) => {
                        e.preventDefault();               // href="#" 기본 동작 막기

                        // 1) 맵 중심 & 줌 초기화
                        map.setCenter(initialCenter);
                        map.setZoom(initialZoom);

                        // 2) 선택된 마커가 있으면 아이콘 원복
                        if (selectedMarker) {
                            selectedMarker.setIcon(selectedMarker.defaultIcon);
                            selectedMarker = null;
                        }
                        // 3) 정보 패널 초기화
                        document.getElementById('building-info').innerHTML = '';
                        document.getElementById('accident-history').innerHTML = '';

                        // 4) 숫자+바 리셋 (태풍·지진·산불)
                        ['tornado','earthquake','fire'].forEach(key => {
                            const textEl = document.getElementById(`${key}-score-text`);
                            const barEl  = document.getElementById(`${key}-score-bar`);
                            textEl.textContent = '0점';
                            barEl.style.width = '0%';
                            barEl.setAttribute('aria-valuenow', 0);
                        });

                        // 5) 홍수/침수 등급 리셋
                        const drownEl = document.getElementById('drown-score-text');
                        // • 기존 색상 클래스 모두 제거
                        drownEl.classList.remove('text-success','text-warning','text-danger','text-secondary');
                        // • 기본 회색 등급으로 표시
                        drownEl.classList.add('text-secondary');
                        // • 텍스트를 “--”로 초기화
                        drownEl.textContent = '--';

                        // 6) bar 차트도 0으로 초기화
                        window.riskBarChart.data.datasets[0].data = [0, 0, 0, 0];
                        window.riskBarChart.update();

                        // 7) 검색창 내부 내용도 비우기
                        const searchInput = document.getElementById('search-input');
                        if (searchInput) {
                          searchInput.value = '';  // 검색 결과나 안내 텍스트 모두 제거
                        }
                    });
            });
    }
    </script>

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCQWM6dFymuis1oh9DelTIPFO1igh1nVuo&callback=initMap">
    </script>
</body>

</html>